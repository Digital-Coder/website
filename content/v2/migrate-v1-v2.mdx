# Migrating V1 to V2

Script for migrating data from Umami V1 to V2.

### Requirements

- Database schema must be in sync with the latest V1 Umami repo. The script will query the prisma migrations table to ensure the latest migrations have been ran.

### Configure umami

Create an `.env` file with the following

```
DATABASE_URL=(connection url)
```

The connection url is in the following format:

```
postgresql://username:mypassword@localhost:5432/mydb

mysql://username:mypassword@localhost:3306/mydb
```

### Usage

- Backup your target database prior to use. Potential data loss may occur if the migration is interrupted.
- For users with larger datasets (5M+), the migration may take while. Please plan accordingly.
- Due to the complexity of migrating a json column and not knowing the data structures being stored, the script will not be migrating event data into V2. The script will retain the V1 `event_data` table if populated.

```shell
npx @umami/migrate-v1-v2
```