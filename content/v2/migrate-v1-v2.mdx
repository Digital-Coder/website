# Migrating v1 to v2

Umami v2 introduces a number of breaking changes. Some hightlights of v2 include:

* A redesigned schema

## Data migration

### Requirements

- Database schema must be in sync with the latest v1 Umami repo. The script will query the prisma migrations table to ensure the latest migrations have been ran.

### Configure umami

Create an `.env` file with the following

```
DATABASE_URL={connection url}
```

The connection url is in the following format:

```
DATABASE_URL=postgresql://username:mypassword@localhost:5432/mydb

DATABASE_URL=mysql://username:mypassword@localhost:3306/mydb
```

### Usage

- Backup your target database prior to use. Potential data loss may occur if the migration is interrupted.
- For users with larger datasets (5M+), the migration may take while. Please plan accordingly.
- Due to the complexity of migrating a JSON column and not knowing the data structures being stored, the script will not be migrating event data into V2. The script will retain the V1 `event_data` table if populated.
- A seperate script will be provided to migrate event data in the near future.

```shell
npx @umami/migrate-v1-v2
```

### Troubleshooting

- If your `DATABASE_URL` is localhost and the migration can't connect to the database, try changing to IP address example: `127.0.0.1`.